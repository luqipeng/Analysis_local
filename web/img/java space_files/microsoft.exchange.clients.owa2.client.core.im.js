try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime();
Type.registerNamespace("_im");_im.$1A6=function(n){_im.$1A6.initializeBase(this);this.$A3=n};_im.$1A6.prototype={$A3:null,$6OS:function(n){this.$A3.set_$1jv(1);n.$7Qa(this.$A3.get_$ju(),null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n===-9){_js.Trace.logInfo(_a.$0.$6z,"AcceptChatAction.ProcessResult: Suppressing 'ConversationEnded' error.");n=0}if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$A3.set_$1jv(3);_js.Trace.logInfo(_a.$0.$6z,"AcceptChatSession web service call succeeded for chat {0}.",this.$A3.get_$ju());t()},$XN:function(){_a.$Fj.prototype.$XN.call(this)}};_im.$102=function(n,t){this.$5a1=n;this.$619=t};_im.$102.prototype={$619:null,$5a1:null,$3kk:function(n,t){return this.$5a1.$3kk(n,t)},$4XW:function(n,t){return this.$5a1.$4XW(n,t)},$AR1:function(n,t){return new _im.$1PY(n,t)},$7gI:function(n){return this.$619.$7gI(n)}};_im.$1Ec=function(n,t){_im.$1Ec.initializeBase(this);this.$A3=n;this.$6s=t};_im.$1Ec.prototype={$A3:null,$6s:null,$kB:function(){_a.$Fj.prototype.$kB.call(this);this.$6s.$E0j(this.$A3)},$6OS:function(n){if(this.$A3.get_$ju()===-1){this.$A3.set_$1jv(4);return}n.$9q6(this.$A3.get_$ju(),null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){this.$A3.set_$1jv(4);if(!n){i(Error.create("EndChatAction returned false."));return}t()}};_im.$1Ed=function(n){this.$6s=n};_im.$1Ed.prototype={$6s:null,$7gI:function(n){return new _im.$1Ec(n,this.$6s)}};_im.$1HK=function(n){_im.$1HK.initializeBase(this);_a.$4.$1Z4(n,"sipUris");this.$1v7=n};_im.$1HK.prototype={$1v7:null,$6OS:function(n){n.$8Hd(this.$1v7,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){i(Error.create("GetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1JN=function(n){_im.$1JN.initializeBase(this);this.$3J0=n};_im.$1JN.prototype={$3J0:!1,$2Yx:!1,$6OS:function(n){n.$8Qh(this.$3J0,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){if(n!==-2){_js.Trace.logInfo(_a.$0.$6z,"Sign in failed with code {0}, will retry.",n);this.$2Yx=!0}i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$13b=function(n){_im.$13b.initializeBase(this);this.$3J0=n};_im.$13b.prototype={$3J0:!1,$6OS:function(n){n.$8Qi(this.$3J0,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$1P0=function(){_im.$1P0.initializeBase(this)};_im.$1P0.prototype={$6OS:function(n){n.$3Vx(null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){i(Error.create("ResetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1PY=function(n,t){_im.$1PY.initializeBase(this);this.$A3=n;this.$3V=t};_im.$1PY.prototype={$3V:null,$A3:null,$kB:function(){_a.$Fj.prototype.$kB.call(this)},$6OS:function(n){this.$A3.get_$1jv()||this.$A3.set_$1jv(1);var t=new _g.$Zz(this.$3V);t.ChatSessionId=this.$A3.get_$ju();t.Recipients=this.$A3.$BrG();t.Subject=this.$A3.get_$3o();n.$73d(t,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$A3.set_$ju(n);this.$A3.set_$1jv(3);t()},$XN:function(){$C(this.$2H.message)&&this.$A3.$x0(_nbs.NonBootStrings.l_IMDeliveryError_Text);_a.$Fj.prototype.$XN.call(this)}};_im.$1QM=function(n,t){_im.$1QM.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Sz=n;this.$46k=t};_im.$1QM.prototype={$Sz:null,$46k:"None",$6OS:function(n){var t=new _g.$dw;t.Presence=this.$46k;n.$7CS(t,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){var r=n;if(r){i(Error.create("SetPresenceAction failed with InstantMessageOperationError: "+r));return}t()}};_im.$Y0=function(n,t,i,r,u){_im.$Y0.initializeBase(this);_a.$4.$X(i,"participants");_a.$4.$1BF(i.get_$A(),0,"participants.Count");if(!$C(u)){if(i.get_$A()!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(!$C(r))throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.$6s=n;this.$1NB=this.$7gQ(i);_a.$4.$1BF(this.$1NB.get_$A(),0,"No valid participants.");this.$2ZW=t;this.$3KS=r;this.$1Td=u};_im.$Y0.prototype={$6s:null,$2ZW:null,$1NB:null,$3KS:null,$1Td:null,$kB:function(){_a.$Fj.prototype.$kB.call(this);if(!$C(this.$2ZW)){this.$2ZW.$9nO(this.$1NB,this.$3KS,this.$1Td);return}this.$6s.$9nO(this.$1NB,this.$3KS,this.$1Td)},$988:function(){return 0},$7gQ:function(n){for(var u=new _js.$X,f={},e=n.get_$A(),i=0;i<e;i++){var t=n.get_$E(i);if(t&&this.$6s.$1jr(t.get_$DF())){var r=t.get_$DF();if(!(r in f)){u.$F(t);f[r]=t}}}return u}};_im.$18i=function(n,t){this.$6s=n;this.$2ZW=t};_im.$18i.prototype={$6s:null,$2ZW:null,$3kk:function(n,t){return new _im.$Y0(this.$6s,this.$2ZW,n,t,null)},$4XW:function(n,t){var i=new _js.$X;i.$F(n);return new _im.$Y0(this.$6s,this.$2ZW,i,null,t)}};_im.$1R9=function(n){_im.$1R9.initializeBase(this);_a.$4.$1Z4(n,"sipUris");this.$1v7=n};_im.$1R9.prototype={$1v7:null,$6OS:function(n){n.$9oU(this.$1v7,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){i(Error.create("SubscribeForPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1TH=function(n){_im.$1TH.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Sz=n};_im.$1TH.prototype={$Sz:null,$6OS:function(n){n.$9tI(this.$Sz,null,this.$$d_$6qf,this.$$d_$1Mz)},$6vl:function(n,t,i){if(n<0){i(Error.create("UnsubscribeFromPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1CO=function(n){this.$62W=n.get_$EpW();this.$iy={}};_im.$1CO.prototype={$62W:0,$iy:null,$F:function(n){this.$7pW();this.$iy[n.toString()]=this.$2k7()},$Hq:function(n){this.$7pW();return n.toString()in this.$iy},$2k7:function(){return _a.$8.get_$38()},$7pW:function(){var s=this.$2k7();var u=new(_ff.$18.$$(String));var f=this.$iy;for(var r in f){var i={key:r,value:f[r]};var h=i.value;var c=h.$1wq(this.$62W);c.$3t(s)<0&&u.$F(i.key)}for(var t=u.$3Q(),o=t.length,n=0;n<o;++n){var e=t[n];delete this.$iy[e]}}};_im.$4s=function(n,t,i,r,u,f,e){this.$$d_$9z7=Function.createDelegate(this,this.$9z7);this.$$d_$DkW=Function.createDelegate(this,this.$DkW);this.$$d_$DkX=Function.createDelegate(this,this.$DkX);this.$$d_$DaX=Function.createDelegate(this,this.$DaX);this.$$d_$EgJ=Function.createDelegate(this,this.$EgJ);this.$$d_$3vp=Function.createDelegate(this,this.$3vp);this.$$d_$DVE=Function.createDelegate(this,this.$DVE);this.$$d_$Dhu=Function.createDelegate(this,this.$Dhu);this.$$d_$Dhv=Function.createDelegate(this,this.$Dhv);this.$$d_$Djz=Function.createDelegate(this,this.$Djz);this.$$d_$Dk0=Function.createDelegate(this,this.$Dk0);this.$$d_$9Ch=Function.createDelegate(this,this.$9Ch);this.$$d_$9Ci=Function.createDelegate(this,this.$9Ci);this.$$d_$DQc=Function.createDelegate(this,this.$DQc);this.$$d_$5EH=Function.createDelegate(this,this.$5EH);this.$$d_$9og=Function.createDelegate(this,this.$9og);this.$1Zq=new _js.$X;this.$BB=new _js.$X;this.$gw=new _js.$X;_im.$4s.resolveInheritance();this.apcl=this.$p;this.rpcl=this.$1B;_im.$4s.initializeBase(this);this.$nJ("Initialization","unknown");this.$Yt=t;this.add_$2Ur(this.$Yt.$$d_$9ve);if(!n){this.$nJ("Initialization","Disabled");return}this.$n=i;this.$28k=!0;this.$1gF=!1;this.$4rx=new _im.$1CO(_a.$D6.$AtD(30));var s=new _g.$98;s.NotificationType="InstantMessageNotification";this.$T1=new _h.$D5(s,this.$n,r);this.$T1.add_$3c7(this.$$d_$9og);if(u&&e){this.$3Ho=!0;_js.Trace.logInfo(_a.$0.$6z,"ChatManager: Waiting for the pending-get activation event.");var o=this;u.$1k(_a.$S7,function(n){_js.Trace.logInfo(_a.$0.$6z,"ChatManager: Pending-get activated.");o.$1WO=!0;o.$5ZA()});var h=this;u.$1k(_a.$o9,function(){h.$7QX()});u.$1k(_a.$Lt,this.$$d_$5EH);f?this.$3e(f):this.$Wj="Disabled"}this.$1Zq.add_$22(this.$$d_$DQc);this.$3U1=this.$AQ3(this.$n)};_im.$4s.$9s9=function(n,t,i){var r;var f,u;if(u=n.$3da(function(n){return n.get_$ju()===t},f={val:r}),r=f.val,u){i.val=r;return!0}i.val=null;return!1};_im.$4s.$Eql=function(n,t,i){var r;var f,u;var e=(u=n.$3da(function(n){var i=n;if(i.get_$g6().get_$A()!==1)return!1;var r=i.get_$g6().get_$E(0);return r.get_$DF()===t?!0:!1},f={val:r}),r=f.val,u);i.val=r;return e};_im.$4s.prototype={$Yt:null,$3Ho:!1,$3lI:null,$1ym:null,$1WO:!1,$2FS:!1,$6Pe:!1,$4rx:null,$n:null,$4Da:!1,$28k:!1,$2yS:!1,$Wj:"unknown",$2ZH:null,$1gF:!1,$T1:null,$3U1:null,add_$2Ur:function(n){this.$32(_im.$4s.$27t,n)},remove_$2Ur:function(n){this.$5d(_im.$4s.$27t,n)},get_$4I5:function(){return this.$Wj},get_$vS:function(){return this.$Wj==="SignedIn"},get_$2t:function(){this.$4Rm("IsEnabled");return this.$Wj!=="Disabled"},get_$9zd:function(){return this.$1Zq},get_$3vx:function(){return this.$BB},get_$5oH:function(){return this.$gw},get_$C9i:function(){return this.$6Pe},get_$2GF:function(){this.$4Rm("CurrentUserSipUri");return this.$1ym},$5Z8:function(n){if(!this.$1WO){_js.Trace.logInfo(_a.$0.$6z,"Ignoring a SignIn attempt because the pending-get connection is not yet started.");return}this.$28k=!0;this.$1gF=n;this.$3vp()},$5ZC:function(n){_js.Trace.logInfo(_a.$0.$6z,"Signing out.");var t=new _im.$13b(n);t.add_$2s(this.$$d_$9Ci);t.add_$2b(this.$$d_$9Ch);this.$nJ("SignOut:Manual="+n,"AttemptingSignOut");this.$n.$1U(t)},$2bd:function(n,t,i){var f=_im.$4h.$fG(t);var e;var r,u;var o=(u=this.$Yt.$5dm(f,r={val:e}),e=r.val,u);this.$63T(n,f,_im.$4h.$2LM(i),o)},$Eku:function(n,t){var i=new _im.$1QM(_im.$4h.$fG(n),t);i.add_$2s(this.$$d_$Dk0);i.add_$2b(this.$$d_$Djz);this.$n.$1U(i)},$nJ:function(n,t){t==="Error";_js.Trace.logInfo(_a.$0.$6z,"SignInState: {0} Requesting change from {1} to {2}",n,this.$Wj,t);var i=this.get_$vS();if(this.$Wj!==t){this.$Wj=t;this.$4(_im.$4s.$2ZJ);this.get_$vS()!==i&&this.$4(_im.$4s.$4yR)}},$7Me:function(n,t){_js.Trace.logInfo(_a.$0.$6z,"Setting current user SIP URI to {0}",t);this.$1ym=t},$3Vx:function(){if(this.$Wj==="SignedIn"){_js.Trace.logInfo(_a.$0.$6z,"ResetPresence");var n=new _im.$1P0;n.add_$2s(this.$$d_$Dhv);n.add_$2b(this.$$d_$Dhu);this.$n.$1U(n)}},$9nO:function(n,t,i){_js.Trace.logInfo(_a.$0.$6z,"Starting chat.");_a.$4.$z(n,"basePersonaParticipants");_a.$4.$1BF(n.get_$A(),0,"basePersonaParticipants.Count");$C(i)||_a.$4.$S5(n.get_$A(),1,"When imAddress is specified, participant count must be 1.");for(var u=new _js.$X,w=n.get_$A(),o=0;o<w;o++){var y=n.get_$E(o);var p=_pc.$q.$2Fn(y);u.$F(p)}var r=null;if(u.get_$A()===1){var e=u.get_$E(0);var f=null;$C(i)?$C(e.get_$DF())||(f=e.get_$DF()):f=i;if(!$C(f)){var h,s;s=_im.$4s.$Eql(this.$1Zq,f,h={val:r}),r=h.val,s}var c=e.get_$26();if(!_js.$9.$1h(f)&&!_js.$9.$1h(c)){var v=_im.$4h.$fG(f);this.$Yt.$2W("StartChat (single participant)",v,c,e.$Hg,!0)}}else{var l=this;u.$Cj(function(n){var t=n;var r=t.get_$DF();var i=t.get_$26();if(!_js.$9.$1h(r)&&!_js.$9.$1h(i)){var u=_im.$4h.$fG(r);l.$Yt.$2W("StartChat (multiple participants)",u,i,t.$Hg,!0)}})}if(!r){r=this.$7fr(u,t);this.$7Qm(r);if(!$C(i)){var a=u.get_$E(0);r.$EWS(a,i)}}_g.$11.isInstanceOfType(t)?r.set_$8bg(t):_g.$6W.isInstanceOfType(t)&&r.set_$8bc(t);return r},$3fa:function(n){_js.Trace.logInfo(_a.$0.$6z,"Accepting invitation.");this.$BB.$3M(n);this.$7Qm(n);var t=new _im.$1A6(n);this.$n.$1U(t)},$3uz:function(n){_js.Trace.logInfo(_a.$0.$6z,"Ignoring invitation.");this.$BB.$3M(n);this.$4rx.$F(n.get_$ju())},$9zC:function(n){_js.Trace.logInfo(_a.$0.$1Pw,"Accepting buddy request {0} ",n.get_$2Z());var u=this.$gw.$3M(n);var r=this.$4ns(n);var t=new _g.$W7;t.GroupType="OtherContacts";var i=new _c.$1A5(r,t);this.$n.$1U(i)},$ATa:function(n){_js.Trace.logInfo(_a.$0.$1Pw,"Ignoring buddy request {0} ",n.get_$2Z());this.$gw.$3M(n);var i=this.$4ns(n);var t=new _c.$1De(i);this.$n.$1U(t)},$E0j:function(n){_js.Trace.logInfo(_a.$0.$6z,"Removing chat {0}",n.get_$ju());n.set_$1jv(4);n.get_$g6().remove_$22(this.$$d_$DVE);var i=this.$1Zq.$3M(n);var t=this.$BB.$3M(n);$C(n.get_$2O())||_h.$o.get_$Q().$sl(n.get_$2O().Id)},$DaX:function(n){if(n.EventType==="Reload"){_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Received a 'Reload' notification from the OWA server, assuming server has rebooted or connection re-established");this.$28k=!0;this.$3aH(!1);return}var t=n;var i=t.PayloadType;if($C(i)){_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Unexpected notification payload: {0}, {1}",n.EventType,n.toString());return}if(i==="ServiceUnavailable"){if(t.ServiceError==="ClientSignOut"){_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Service unavailable, client signed out.  {0}",t.ErrorMessage);this.$nJ("IMNotification","SignedOut");return}_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Received a 'ServiceUnavailable' notification: {0}, {1}.",t.ServiceError,t.ErrorMessage);this.$3aH(!1);return}if(i==="SignOn")if(t.SignOnStarted){_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: Sign-on started.");return}else{_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: Sign-on succeeded.");this.$3aH(!0);this.$6qJ();this.$6Pe=t.IsUserInUcsMode;return}if(i==="UpdateUserPresence"||i==="UserPresenceChange"||i==="QueryUserPresenceChange"){this.$Aqt(t);return}this.$Yt.$7MS(t);!$C(t.Persona)&&$C(t.Persona.ImAddress)&&(t.Persona.ImAddress=t.SipUri);if(t.PayloadType==="PendingContactList"){if($C(t.PendingContacts)){_js.Trace.logWarning(_a.$0.$1Pw,"The payload for PendingContacts is empty");return}this.$ALZ(t.PendingContacts);return}if(t.PayloadType==="AddToBuddyList"){if($C(t.AddedContacts)){_js.Trace.logWarning(_a.$0.$1Pw,"The payload for AddedContacts is empty");return}this.$E0g(t.AddedContacts)&&_js.Trace.logInfo(_a.$0.$1Pw,"Removed already added contact from pending buddyRequests");return}if(t.PayloadType==="EmptySubscribers"){this.$Alt();_js.Trace.logInfo(_a.$0.$1Pw,"Removed already added contact from pending buddyRequests after receiving emptysubscribers");return}if(!("ChatSessionId"in t)){_js.Trace.logInfo(_a.$0.$6z,"Notification {0} not supported, no session id.",i);return}if(this.$4rx.$Hq(t.ChatSessionId)){_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: {0} for conversation {1} was ignored.",t.PayloadType,t.ChatSessionId);return}_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: {0}, Session={1}, SipUri={2}",i,t.ChatSessionId,t.SipUri);var r;var e,o,u,f;if((o=_im.$4s.$9s9(this.$1Zq,t.ChatSessionId,e={val:r}),r=e.val,o)||(f=_im.$4s.$9s9(this.$BB,t.ChatSessionId,u={val:r}),r=u.val,f)){var s=this.$Yt.$3Et(t.SipUri,t.DisplayName);this.$DuP(t,r,s);return}_js.Trace.logInfo(_a.$0.$6z,"No matching chat found for session {0}",t.ChatSessionId);this.$Er9(t)},$4Uj:function(n){for(var r=n.get_$A(),t=0;t<r;t++){var i=n.get_$E(t);if(i&&this.$1jr(i.SipUri))return!0}return!1},$1jr:function(n){return _js.$9.$1h(n)?!1:_js.$9.$1h(this.get_$2GF())?!1:n.toLowerCase()===this.get_$2GF().toLowerCase()?!1:!0},$2LM:function(n){return _im.$4h.$2LM(n)},$6Iv:function(n){return _im.$4h.$6Iv(n)},$AQ3:function(n){return new _im.$1O9(n)},$AUA:function(){this.$nJ("DelayInternalSignIn","AttemptingSignIn");_js.$D.get_$Q().$2V(_a.$0.$6z,"ChatManager.InternalSignIn",this.$$d_$3vp,3e4)},$2A:function(){this.remove_$2Ur(this.$Yt.$$d_$9ve);_js.$Ec.prototype.$2A.call(this)},$DkX:function(n){_js.Trace.logInfo(_a.$0.$6z,"Sign-in action succeeded.  Awaiting notification.");this.$2ZH=_js.$D.get_$Q().$2V(_a.$0.$6z,"ChatManager.SignInNotificationTimeout",this.$$d_$EgJ,1e4)},$DkW:function(n){_js.Trace.logInfo(_a.$0.$6z,"Sign-in action failed.");var t=n;if(t.get_$4d()===-11){_js.Trace.logInfo(_a.$0.$6z,"Automatic sign-in rejected because the user was explicitly signed out.");this.$nJ("Automatic Sign-In Rejected","SignedOut");return}_js.Trace.logWarning(_a.$0.$6z,"Sign-in failed: {0}",t.$2H.message);this.$3aH(!1)},$EgJ:function(){_js.Trace.logWarning(_a.$0.$6z,"Sign-in timeout expired.  Current sign-in state: {0}, ServiceAvailable: {1}.",this.$Wj,this.$4Da);this.$Wj!=="SignedIn"&&this.$3aH(!1)},$9Ci:function(n){_js.Trace.logInfo(_a.$0.$6z,"Sign-out succeeded.");this.$nJ("SignOutSucceeded","SignedOut")},$9og:function(n,t){if(!this.$2yS){_js.Trace.logInfo(_a.$0.$6z,"Subscribed to notifications.");this.$2yS=!0;this.$3vp()}},$8RT:function(n,t,i){if(this.$Wj!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_js.$9.$o(i)){_js.Trace.logInfo(_a.$0.$6z,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");r="Disabled"}else i=_im.$4h.$fG(i);this.$nJ("Configuration Updated",r)}this.$3lI=t;this.$7Me("InternalSetConfiguration",i);this.$2FS=!0},$3vp:function(){if(!this.$2yS){_js.Trace.logInfo(_a.$0.$6z,"Subscribing to notifications.");this.$T1.$1k(_a.$0.$6z,"OnIMNotification",this.$$d_$DaX,1);return}_js.Trace.logInfo(_a.$0.$6z,"Signing in. Manual: {0}, will retry: {1}",this.$1gF,this.$28k);var n=new _im.$1JN(this.$1gF);n.add_$2s(this.$$d_$DkX);n.add_$2b(this.$$d_$DkW);this.$nJ("InternalSignIn","AttemptingSignIn");this.$n.$1U(n);this.$2ZH&&(this.$2ZH=_js.$D.get_$Q().$6Q(this.$2ZH))},$4ns:function(n){var t=new _g.$W6;_a.$4.$z(n,"persona");t.DisplayName=n.get_$26();t.SipUri=n.get_$DF();return t},$7fr:function(n,t){_js.Trace.logInfo(_a.$0.$6z,"Creating new Chat.");var i=new _h.$1g(!0);i.get_$g6().add_$22(this.$$d_$DVE);i.get_$g6().$1yQ(n);i.set_$2O(new _g.$1T("IM:"+Math.random().toString()));if(!t)return i;if(_g.$11.isInstanceOfType(t)){i.set_$8bg(t);return i}if(_g.$6W.isInstanceOfType(t)){i.set_$8bc(t);return i}var r=_js.$9.$5K("CreateChat: itemOrConversation type {0} is not supported.",Object.getType(t).getName());_js.Trace.logError(_a.$0.$6z,r);throw Error.invalidOperation(r);},$7Qm:function(n){_js.Trace.logInfo(_a.$0.$6z,"Activating chat.");$C(n.get_$2O())||_h.$o.get_$Q().$JZ(n.get_$2O().Id,n);var t=this.$BoW(n);this.$1Zq.$6i(t,n)},$DuP:function(n,t,i){var u=n.PayloadType;switch(u){case"NewChatMessageToast":_js.Trace.logInfo(_a.$0.$6z,"NewChatMessageToast received and mapped to chat {0}.",t.get_$ju());return;case"ParticipantJoined":this.$Yt.$7TE(n);var r;if($C(n.Persona))r=_pc.$q.$4Xq(i,n.SipUri);else{r=new _pc.$q;r.$KH(n.Persona)}t.$DpG(n.SipUri,r,i);return;case"ParticipantLeft":t.$DpH(n.SipUri,i);return;case"EndChatSession":t.$6Ki||this.$BB.$3M(t);return;case"NewChatMessage":t.$9Ae(i,n.MessageContent);return;case"UserActivity":switch(n.UserActivity){case"FailedDelivery":t.$x0(_nbs.NonBootStrings.l_IMDeliveryError_Text);return;case"Typing":t.$Efy(i);return;case"StoppedTyping":t.set_$GZ("");return;case"TwoOrMoreTyping":t.set_$GZ(_nbs.NonBootStrings.l_IMActivityMultipleUsersTyping_Text);return;case"DeliveryTimeout":t.$x0(_nbs.NonBootStrings.l_IMDeliveryTimeout_Text);return;default:return}}},$Er9:function(n){if(n.PayloadType==="NewChatMessageToast"){this.$Yt.$7TE(n);var r=this.$Yt.$3Et(n.SipUri,n.DisplayName);var u=this.$7h4(n.Persona,r,n.SipUri,n.ToastMessage,n.MessageSubject,n.ChatSessionId);_js.Trace.logInfo(_a.$0.$6z,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessageToast).",n.ChatSessionId);return!0}if(n.PayloadType==="NewChatMessage"){var t=this.$Yt.$3Et(n.SipUri,n.DisplayName);var i=this.$7h4(n.Persona,t,n.SipUri,n.MessageContent,"",n.ChatSessionId);i.$9Ae(t,n.MessageContent);_js.Trace.logInfo(_a.$0.$6z,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessage).",n.ChatSessionId);return!0}return!1},$7h4:function(n,t,i,r,u,f){var o;if($C(n))o=_pc.$q.$4Xq(t,i);else{o=new _pc.$q;o.$KH(n)}$C(r)&&(r="");var s=new _js.$X;s.$F(o);var e=this.$7fr(s,null);e.set_$ju(f);e.$2af=o;e.$3d4=r;_js.$9.$1h(u)||e.set_$3o(u);this.$BB.$F(e);return e},$ALZ:function(n){_a.$4.$z(n,"senderInfo");for(var u=n,e=u.length,r=0;r<e;++r){var t=u[r];var i=t.SipUri;_js.Trace.logInfo(_a.$0.$1Pw,"Adding pending contact to buddy requests list",i);var f=this.$3Eu(t.DisplayName,t.Title,i);this.$8Tu(i,!1)||this.$gw.$F(f)}},$E0g:function(n){_a.$4.$z(n,"senderInfo");for(var r=!1,u=n,f=u.length,t=0;t<f;++t){var e=u[t];var i=e.SipUri;_js.Trace.logInfo(_a.$0.$1Pw,"Examining the AddToBuddyList payload for existing buddy requests",i);r=this.$8Tu(i,!0)}return r},$Alt:function(){_js.Trace.logInfo(_a.$0.$1Pw,"Received empty subscribers notification, we need to hide the pending buddy dialogue");this.$gw.$1u()},$3Eu:function(n,t,i){_a.$4.$z(n,"displayName");_a.$4.$z(i,"buddyImAddress");var r=_pc.$q.$4Xq(n,i);_js.$9.$o(t)||r.set_$3u(t);return r},$8Tu:function(n,t){for(var i=0;i<this.$gw.get_$A();i++){var r=this.$gw.get_$E(i);if(!r.get_$DF().localeCompare(n)){if(t){_js.Trace.logInfo(_a.$0.$1Pw,"Removing already added contact from pending buddyRequests",r.get_$DF());this.$gw.$5W(i)}return!0}}return!1},$BoW:function(n){var t=this;return this.$1Zq.$HE(function(t){return n.$40C.$3t(t.$40C)>=0})},$3aH:function(n){this.$2ZH&&(this.$2ZH=_js.$D.get_$Q().$6Q(this.$2ZH));var t=this.$4Da;this.$4Da=n;if(n&&t){_js.Trace.logInfo(_a.$0.$6z,"Service confirmed available.");return}else if(n&&!t){_js.Trace.logInfo(_a.$0.$6z,"Service resumed.");return}else if(!n&&t){_js.Trace.logInfo(_a.$0.$6z,"Service interrupted.");this.$7QX();this.$9PQ();return}else if(!n&&!t){_js.Trace.logInfo(_a.$0.$6z,"Service confirmed unavailable.");this.$9PQ();return}_js.Trace.logError(_a.$0.$6z,"Unexpected condition in ChatManager.SetServiceAvailability.")},$6qJ:function(){this.$nJ("SignedOn Succeeded","SignedIn");this.$28k=!0;this.$1gF=!1},$7QX:function(){this.$1Zq.$Cj(this.$$d_$9z7);this.$BB.$Cj(this.$$d_$9z7);var n=this;this.$1Zq.$Cj(function(t){t.$Eff(n.$4Da)})},$9PQ:function(){if(this.$Wj==="AttemptingSignIn"||this.$Wj==="SignedIn"||this.$Wj==="Error"){if(this.$28k){this.$28k=!1;this.$AUA();return}this.$1gF=!1;this.$nJ("SignIn-GiveUp","Error")}},$9Ch:function(n){_js.Trace.logWarning(_a.$0.$6z,"Sign-out failed: {0}",n.$2H.message);this.$nJ("SignOutFailed","SignedOut")},$Dhv:function(n){_js.Trace.logInfo(_a.$0.$6z,"Reset presence succeeded.")},$Dhu:function(n){_js.Trace.logWarning(_a.$0.$6z,"Reset presence failed: {1}",n.$2H.message)},$Dk0:function(n){var t=n;_js.Trace.logInfo(_a.$0.$6z,"Set presence to {0} succeeded.",t.$46k)},$Djz:function(n){var t=n;_js.Trace.logWarning(_a.$0.$6z,"Set presence to {0} failed: {1}",t.$46k,n.$2H.message)},$9z7:function(n){var t=n;t.set_$ju(-2);t.$Efg()},$63T:function(n,t,i,r){var f=this.$Yt.$3Et(t,null);var e=new _im.$oi(n,t,f,i,r);var u=this.$v6(_im.$4s.$27t);u&&u(e)},$Aqt:function(n){var u=this.$v6(_im.$4s.$27t);if(u){var e=n.PayloadType;if(n.PayloadType==="UpdateUserPresence"){var r=n.DisplayName;_js.$9.$1h(r)&&(r=this.$3lI);var s=new _im.$oi(e,this.$1ym,r,_im.$4h.$2LM(n.NewUserPresence),!0);u(s);return}if(!$C(n.UserPresenceChanges))for(var h=n.PayloadType!=="QueryUserPresenceChange",f=n.UserPresenceChanges,c=f.length,i=0;i<c;++i){var t=f[i];var o=new _im.$oi(e,t.SipUri,t.UserName,_im.$4h.$2LM(t.Presence),h);u(o)}}},$DVE:function(n,t){switch(t.$3R){case 0:var f=t.$4C;var e=this.$8Cn(f);this.$3U1.$7U6(e);break;case 2:var u=t.$4X;var i=this.$8Cn(u);var r=this.$7q9(i);this.$3U1.$2Vl(r);break;case 1:case 3:default:_a.$4.$FY(!1,"Unexpected notification received: "+t.$3R);break}},$8Cn:function(n){var r=new(_ff.$18.$$(String));if(n)for(var i=n,f=i.length,t=0;t<f;++t){var u=i[t];this.$7T7(r,u)}return r},$7q9:function(n){for(var f=this.$6FQ(this.$1Zq.$3Q()),u=new(_ff.$18.$$(String)),r=n.get_$1y(),e=r.length,t=0;t<e;++t){var i=r[t];f.$5l(i)||u.$F(i)}return u},$DQc:function(n,t){switch(t.$3R){case 0:var f=t.$4C;var e=this.$6FQ(f);this.$3U1.$7U6(e);break;case 2:var u=t.$4X;var i=this.$6FQ(u);var r=this.$7q9(i);this.$3U1.$2Vl(r);break;case 1:case 3:default:_a.$4.$FY(!1,"Unexpected notification received: "+t.$3R);break}},$6FQ:function(n){var r=new(_ff.$18.$$(String));if(n)for(var u=n,e=u.length,t=0;t<e;++t){var o=u[t];var i=o;if(i.get_$g6()){var f=this;i.get_$g6().$Cj(function(n){f.$7T7(r,n)})}}return r},$7T7:function(n,t){var r=t;var i=_im.$4h.$fG(r.get_$DF());i.localeCompare(this.$1ym)&&(n.$5l(i)||n.$F(i))},$4Rm:function(n){this.$3Ho&&(this.$Wj==="unknown"||!this.$2FS)&&_js.Trace.logError(_a.$0.$6z,"ChatManager: Do not access {0} until configuration has loaded.",n)},$5ZA:function(){if(this.get_$2t()&&this.$1WO&&this.$2FS){var n=this;_js.$D.get_$Q().$2V(_a.$0.$6z,"ChatManager.SignIn",function(){n.$5Z8(!1)},5e3)}},$3e:function(n){var r=n.get_$9N().get_$3vk();var i=n.get_$4P().get_$Lk();var t=n.get_$4P().get_$1wD();this.$8RT(r,i,t);this.$5ZA()},$5EH:function(n){if(!n.$1QZ){this.$28k=!1;this.$3aH(!1)}}};_im.$103=function(n,t,i,r,u,f,e){this.$43=n;this.$Yt=t;this.$n=i;this.$2yP=r;this.$N=u;this.$d=f;this.$1og=e};_im.$103.prototype={$43:!1,$Yt:null,$n:null,$2yP:null,$N:null,$d:null,$1og:!1,$6s:null,$9:function(){this.$6s||(this.$6s=new _im.$4s(this.$43,this.$Yt,this.$n,this.$2yP,this.$N,this.$d.get_$1Z(),this.$1og));return this.$6s}};_im.$Lm=function(){this.$$d_$9ve=Function.createDelegate(this,this.$9ve);_im.$Lm.initializeBase(this);this.$Fx={}};_im.$Lm.prototype={$Fx:null,$3Vx:function(){var t=this.$Fx;for(var n in t){var r={key:n,value:t[n]};var i=r.value;i.set_$I2(0)}},$7MS:function(n){this.$9vd(n,!1)},$7TE:function(n){this.$9vd(n,!0)},$9ve:function(n){this.$2W(n.$2k,n.$Sz,n.$6u,n.$Hg,n.$2NL)},$2W:function(n,t,i,r,u){this.$5ep(n,t,i,u);this.$2bd(n,t,r,u)},$3Et:function(n,t){var i=t;if(_js.$9.$1h(i)&&!_js.$9.$1h(n)){n=_im.$4h.$fG(n);var r=this.$Fx[n];$C(r)||(i=r.$6u);_js.$9.$1h(i)&&(i=_im.$4h.$z1(n))}return i},$5dm:function(n,t){t.val=0;n=_im.$4h.$fG(n);var i=this.$Fx[n];if($C(i))return!1;t.val=i.$Hg;return!0},$9vd:function(n,t){if(!_js.$9.$1h(n.SipUri)){this.$5ep(n.PayloadType,n.SipUri,n.DisplayName,t);if(!$C(n.NewUserPresence)){var i=_im.$4h.$2LM(n.NewUserPresence);this.$2bd(n.PayloadType,n.SipUri,i,t)}}},$5ep:function(n,t,i,r){var u=this;this.$5f9(n,t,r,function(n){_js.$9.$1h(i)||n.set_$26(i)})},$2bd:function(n,t,i,r){var u=this;this.$5f9(n,t,r,function(n){$C(i)||n.set_$I2(i)})},$5f9:function(n,t,i,r){t=_im.$4h.$fG(t);var u=this.$Fx[t];if($C(u)){if(!i)return;u=new _im.$104(t);this.$Fx[t]=u}r(u)}};_im.$104=function(n){_im.$104.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Sz=n};_im.$104.prototype={$Sz:null,$6u:null,$Hg:0,set_$26:function(n){if(this.$6u===n)return n;this.$6u=n;this.$4("DisplayName");return n},set_$I2:function(n){if(this.$Hg===n)return n;this.$Hg=n;this.$4("Presence");return n},toString:function(){return String.format("SipUri: {0}, DisplayName: {1}, Presence: {2}",this.$Sz,$C(this.$6u)?"":this.$6u,this.$Hg)}};_im.$105=function(n,t,i,r){this.$$d_$DcM=Function.createDelegate(this,this.$DcM);this.$hc=n;this.$6s=t;this.$14g=i;this.$11s=r;this.$14g.add_$19r(this.$$d_$DcM);this.$11s.add_$19r(this.$$d_$DcM)};_im.$105.prototype={$6s:null,$14g:null,$11s:null,$hc:!1,$6v:null,$2m4:!1,$6Wm:0,add_$wH:function(n){if(n&&this.$hc){if(this.get_$G8()){n();return}this.$6v||(this.$6v=new Sys.EventHandlerList);this.$6v.addHandler("chatInitialized",n)}},get_$H3:function(){return this.get_$G8()&&this.$hc?this.$6s:null},get_$27s:function(){return this.get_$G8()&&this.$hc?this.$14g.get_$1Z():null},get_$1QF:function(){return this.get_$G8()&&this.$hc?this.$11s.get_$1Z():null},get_$rz:function(){return this.$hc},get_$G8:function(){if(!this.$2m4&&this.$hc){this.$14g.$9(null);this.$11s.$9(null)}return this.$2m4||!this.$hc},$DcM:function(){this.$6Wm++;if(this.$6Wm===2){this.$2m4=!0;if(this.$6v){this.$6v.getHandler("chatInitialized")();this.$6v=null}}}};_im.$106=function(n,t,i,r,u){this.$hc=n;this.$6s=t;this.$14g=i;this.$11s=r;this.$BR=u};_im.$106.prototype={$hc:!1,$6s:null,$14g:null,$11s:null,$BR:0,$1Q:null,$9:function(){_a.$4.$S5(this.$BR,"Mouse","ChatProviderFactory.Create - Layout");this.$1Q||(this.$1Q=new _im.$105(this.$hc,this.$6s,this.$14g,this.$11s));return this.$1Q}};_im.$16m=function(n,t,i){_im.$16m.initializeBase(this,[n,t,i]);_js.Trace.logInfo(_a.$0.$6z,"PopOutPresenceManager.Ctor.")};_im.$16m.prototype={get_isPopout:function(){return!0},$AQ2:function(){return new _im.$1Nz(this.$1Wf)},$5FP:function(n){this.$7Lb(n.$Sz,n.$Hg)},$7N7:function(n){this.$2W0.$7TF(n)},$ExH:function(){}};_im.$1Nz=function(n){_im.$1Nz.initializeBase(this,[n]);_js.Trace.logInfo(_a.$0.$6z,"PopOutPresenceRequestsManager.Ctor")};_im.$1Nz.prototype={$7TF:function(n){_a.$4.$1s(n,"sipUri");this.$1Wf.queryPresenceInMainWindow(n)},$E23:function(n){_a.$4.$1s(n,"sipUri");return!0},$AG0:function(){}};_im.$oh=function(n,t,i){this.$$d_$99C=Function.createDelegate(this,this.$99C);this.$$d_$5FP=Function.createDelegate(this,this.$5FP);this.$$d_$9Cg=Function.createDelegate(this,this.$9Cg);this.$b6={};_im.$oh.initializeBase(this);_a.$4.$X(n,"chatManager");_a.$4.$X(t,"chatParticipantCache");_a.$4.$X(i,"presenceCrossWindowNotifier");this.$6s=n;this.$Fx=t;this.$6s.$p(_im.$4s.$2ZJ,this.$$d_$9Cg);this.$6s.add_$2Ur(this.$$d_$5FP);this.$1Wf=i;this.$2W0=this.$AQ2();this.$2nY=this.$6s.$Wj;_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.Ctor.")};_im.$oh.prototype={$6s:null,$Fx:null,$1Wf:null,$2W0:null,$2nY:"unknown",get_$vS:function(){return this.$6s.$Wj==="SignedIn"},$7LV:function(n){_a.$4.$X(n,"persona");if(!this.$6s.get_$2t())return!1;_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.TryRegisterForPresenceUpdates: Registering persona for presence updates: {0}, SIP:{1}",n.get_$B6(),n.get_$DF()||"");n.apcl("ImAddress",this.$$d_$99C);if(_js.$9.$1h(n.get_$DF()))return!0;var t=_im.$4h.$fG(n.get_$DF());this.$Ews(t,n);this.$7N7(t);return!0},$7La:function(n){_a.$4.$X(n,"persona");_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.TryUnregisterForPresenceUpdates: Unregistering persona for presence updates: {0}, SIP:{1}",n.get_$B6(),n.get_$DF()||"");return this.$5du(n,n.get_$DF())},$Dw5:function(n,t){_a.$4.$1s(n,"sipUri");this.$7N7(n);t.val=0;if(n in this.$b6){var i=this.$b6[n];if(i.get_$A()>0){t.val=i.get_$E(0).get_$I2();return!0}}return!1},$AQ2:function(){return new _im.$SL(this.$1Wf)},$7N7:function(n){if(this.get_$vS()){var t;var r,i;(i=this.$Fx.$5dm(n,r={val:t}),t=r.val,i)&&this.$7Lb(n,t);n!==_im.$4h.$fG(this.$6s.get_$2GF())&&this.$2W0.$7TF(n)}},$5FP:function(n){if(this.get_$vS()){this.$7Lb(n.$Sz,n.$Hg);this.$1Wf.updatePresenceInAllPopOutWindows(n.$Sz,n.$Hg)}},$7Lb:function(n,t){n=_im.$4h.$fG(n);if(!(n in this.$b6))return!1;for(var r=this.$b6[n],i=0;i<r.get_$A();i++){var u=r.get_$E(i);u.set_$I2(t)}return!0},$ExH:function(){this.$1Wf.updateSignInStateInAllPopOutWindows(this.$2nY)},$2A:function(){_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.InternalDispose.");this.$6s.$1B(_im.$4s.$2ZJ,this.$$d_$9Cg);this.$6s.remove_$2Ur(this.$$d_$5FP);this.$2W0.$1v();this.$2W0=null},$5du:function(n,t){if(!this.$6s.get_$2t())return!1;n.rpcl("ImAddress",this.$$d_$99C);if(_js.$9.$1h(t))return!1;var i=_im.$4h.$fG(t);if(!(i in this.$b6))return!1;var r=this.$b6[i];var u=r.$3M(n);if(!r.get_$A()){delete this.$b6[i];this.$2W0.$E23(i)}return u},$9Cg:function(n,t){var a=n;var r=this.$2nY;var y=r==="SignedIn";this.$2nY=a.$Wj;var s=this.get_$vS();if(y!==s)if(s){_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Requesting presence for every persona active.",r,this.$2nY);var e=this.$b6;for(var f in e){var c={key:f,value:e[f]};var l=c.key;this.$7N7(l)}}else{_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",r,this.$2nY);var h=this.$b6;for(var o in h)for(var v={key:o,value:h[o]},u=v.value,i=0;i<u.get_$A();i++)u.get_$E(i).set_$I2(0);this.$2W0.$AG0();this.$Fx.$3Vx()}this.$ExH()},$99C:function(n,t){var i=n;var r=null;var e=this.$b6;for(var f in e){var u={key:f,value:e[f]};var s=u.key;var o=u.value;if(o.$5l(i)){r=s;break}}_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnImAddressChangedForAPersona: Unregistering persona {0} for old IM Address {1}",i.get_$B6(),r);this.$5du(i,r);_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnImAddressChangedForAPersona: Re-registering persona {0} for new IM Address {1}",i.get_$B6(),$C(i.get_$DF())?"":i.get_$DF());this.$7LV(i)},$Ews:function(n,t){n in this.$b6||(this.$b6[n]=new(_a.$u.$$(_bc.$mU)));var i=this.$b6[n];if(!i.$5l(t)){i.$F(t);i.get_$A()>1?t.set_$I2(i.get_$E(0).get_$I2()):this.get_$vS()||t.set_$I2(0)}}};_im.$SL=function(n){this.$$d_$Dlm=Function.createDelegate(this,this.$Dlm);this.$$d_$DZG=Function.createDelegate(this,this.$DZG);this.$$d_$Df6=Function.createDelegate(this,this.$Df6);this.$1NE=new(_a.$u.$$(String));_im.$SL.initializeBase(this);_a.$4.$z(n,"presenceCrossWindowNotifier");this.$1Wf=n;this.$1NE.add_$22(this.$$d_$Df6);_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.Ctor")};_im.$SL.prototype={$1Wf:null,$2e6:null,$7TF:function(n){_a.$4.$1s(n,"sipUri");if(!this.$1NE.$5l(n)){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.AddOrUpdatePendingGetRequests: Queuing a presence retrieval request for sip {0}",n);this.$1NE.$F(n)}},$E23:function(n){_a.$4.$1s(n,"sipUri");return this.$1NE.$3M(n)},$AG0:function(){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.ClearAll: Clearing all pending get presence requests: {0}",this.$1NE.get_$A());this.$1NE.$1u()},$2A:function(){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.InternalDispose.");this.$7Zm()},$7Zm:function(){if(this.$2e6){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.CancelBatchGetPresenceRequestsTimer.");this.$2e6=_js.$D.get_$Q().$6Q(this.$2e6)}},$Dlm:function(){this.$2e6=null;var t=this.$1NE.$3Q();var i=t.join("; ");this.$1NE.$1u();var n=new _im.$1HK(t);n.add_$4Q(this.$$d_$DZG);OwaApplication.$2B.$1U(n)},$Df6:function(n,t){if(this.$1NE.get_$A()>0){if(!this.$2e6){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Activating timer to run after {0}ms. Current count of pending requests = {1}",_im.$SL.$7Jp,this.$1NE.get_$A());this.$2e6=_js.$D.get_$Q().$2V(_a.$0.$I2,"GetPresence",this.$$d_$Dlm,_im.$SL.$7Jp)}}else{_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Cancelling timer. Current count of pending requests = {0}",this.$1NE.get_$A());this.$7Zm()}},$DZG:function(n){var t=n;var i=t.$1v7.join("; ");if(t.$2H){_js.Trace.logWarning(_a.$0.$I2,"PresenceRequestsManager.OnGetPresenceActionCompleted: Failed with {0} for {1} SipUris: '{2}'",t.$2H,this.$1NE.get_$A(),i);return}}};_im.$1O9=function(n){this.$$d_$DmH=Function.createDelegate(this,this.$DmH);this.$$d_$48H=Function.createDelegate(this,this.$48H);this.$$d_$Dl7=Function.createDelegate(this,this.$Dl7);this.$n=n;this.$2ag=new(_ff.$18.$$(String));this.$2cv=new(_ff.$18.$$(String));this.$2BF=new(_ff.$18.$$(String))};_im.$1O9.prototype={$n:null,$2ag:null,$2cv:null,$2BF:null,$4Qn:!1,$7U6:function(n){for(var i=new(_ff.$18.$$(String)),f=n.get_$1y(),e=f.length,r=0;r<e;++r){var t=f[r];if(this.$2BF.$5l(t)){this.$2BF.$3M(t);continue}this.$2cv.$5l(t)||this.$2ag.$5l(t)||i.$5l(t)||i.$F(t)}if(i.get_$A()>0){this.$2ag.$3y(i.get_$1y());var u=new _im.$1R9(i.get_$1y());u.add_$2s(this.$$d_$Dl7);u.add_$2b(this.$$d_$48H);this.$n.$1U(u)}},$2Vl:function(n){for(var i=0;i<n.get_$A();i++){var t=n.get_$E(i);if(this.$2ag.$5l(t)){this.$2ag.$3M(t);continue}this.$2BF.$5l(t)||this.$2cv.$5l(t)&&this.$2BF.$F(t)}this.$9np()},$9np:function(){if(this.$2BF.get_$A()&&!this.$4Qn){this.$4Qn=!0;var t=this.$2BF.get_$E(0);this.$2BF.$5W(0);this.$2cv.$3M(t);var n=new _im.$1TH(t);n.add_$4Q(this.$$d_$DmH);this.$n.$1U(n)}},$DmH:function(n){this.$4Qn=!1;this.$9np()},$Dl7:function(n){for(var f=n,r=f.$1v7,u=r.length,t=0;t<u;++t){var i=r[t];this.$2cv.$5l(i)||this.$2cv.$F(i);this.$2ag.$3M(i)}_js.Trace.logInfo(_a.$0.$6z,"SubscribeForPresenceUpdates: succeeded.")},$48H:function(n){for(var r=n,i=r.$1v7,e=i.length,t=0;t<e;++t){var f=i[t];this.$2ag.$3M(f)}var u=r.$1v7.join(";");_js.Trace.logInfo(_a.$0.$6z,"SubscribeForPresenceUpdates: failed to subscribe for: {0}.",u)}};_im.$oi=function(n,t,i,r,u){_a.$4.$1s(n,"source");_a.$4.$1s(t,"sipUri");this.$2k=n;this.$Sz=t;this.$6u=i;this.$Hg=r;this.$2NL=u};_im.$oi.prototype={$2k:null,$Sz:null,$6u:null,$Hg:0,$2NL:!1,toString:function(){return String.format("Source: {0}, Sip: {1}, DisplayName: {2}, Presence: {3}, IsAboutMeOrMyBuddy: {4}",this.$2k,this.$Sz,$C(this.$6u)?"":this.$6u,this.$Hg,this.$2NL)}};_im.$4h=function(){};_im.$4h.$2LM=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"None":return 0;case"Offline":return 1;case"Online":return 2;default:return 0}};_im.$4h.$6Iv=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline";case 0:default:return"None"}};_im.$4h.$fG=function(n){_a.$4.$1s(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")||(t="sip:"+t);return t};_im.$4h.$z1=function(n){_a.$4.$1s(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")&&(t=t.substr(4));return t};function IMComponent(){}IMComponent.prototype={$2FT:function(n,t,i){var c=this;n.$r(_im.$Lm).$1I().$t(function(){return new _im.$Lm});var h=this;n.$r(_h.$14A).$1I().$t(function(){return new _im.$1R1(n.$2(_y.$Dp))});var l=this;n.$r(IChatManagerFactory).$1I().$t(function(){var t=i.get_$AA()==="Mouse"&&!_a.$7b.$zE();return new _im.$103(t,n.$2(_im.$Lm),n.$2(_a.$2Y),null,n.$2(_ff.$M),n.$Tt(_g.$2Z),i.get_$Cp())});var v=this;n.$r(_im.$4s).$1I().$t(function(){return n.$2(IChatManagerFactory).$9()});var a=this;n.$r(IChatActionFactory).$1I().$t(function(){var t;t=i.get_$1oh()?new _im.$18i(n.$2(_im.$4s),n.$2(_h.$14A)):new _im.$18i(n.$2(_im.$4s),null);return new _im.$102(t,new _im.$1Ed(n.$2(_im.$4s)))});var s=this;n.$r(_im.$ry).$2a(IChatViewModelFactory).$t(function(){return new _im.$ry(n.$2(_y.$W),n.$2(_rw.$QP),n.$2(_y.$Dp))});if(i.get_$1oh()){var r=this;n.$r(_im.$16m).$2a(IPresenceManager).$1I().$t(function(){return new _im.$16m(n.$2(_im.$4s),n.$2(_im.$Lm),n.$2(_y.$Dp))})}else{var u=this;n.$r(_im.$oh).$2a(IPresenceManager).$1I().$t(function(){return new _im.$oh(n.$2(_im.$4s),n.$2(_im.$Lm),n.$2(_y.$Dp))})}var f=this;n.$r(IChatProviderFactory).$1I().$t(function(){return new _im.$106(i.get_$AA()==="Mouse"&&!_a.$7b.$zE(),n.$2(_im.$4s),n.$36(IPresenceManager),n.$36(IChatActionFactory),i.get_$AA())});var o=this;n.$r(_im.$rx).$1I().$t(function(){return new _im.$rx(i.get_$AA(),n.$2(_g.$O).get_$8O9(),n.$2(_im.$4s),n.$2(_im.$ry))});var e=this;n.$r(ILwxViewModel).$1I().$t(function(){return null})},$Bl2:function(){return[new _a.$4V(_im.$rx,2,1),new _a.$4V(_im.$4s,2,1)]}};_im.$rx=function(n,t,i,r){if(n==="Mouse"&&t){var u=this;i.get_$9zd().add_$22(function(n,t){if(!t.$3R)for(var i=0;i<t.$4C.length;i++){var u=t.$4C[i];r.$9Dp(u)}})}};_im.$Ez=function(n,t,i,r){this.$$d_$4Sn=Function.createDelegate(this,this.$4Sn);this.$$d_$Dev=Function.createDelegate(this,this.$Dev);this.$$d_$5Fm=Function.createDelegate(this,this.$5Fm);_im.$Ez.initializeBase(this);this.$Rt=r;this.$A3=n;this.$LB=new _C(this.$$d_$5Fm,_a.$0.$6z);this.set_$3TB(i.$1CT(1,_bc.$6a.$11g,this.$A3.get_$g6(),1));this.$A3.get_$g6().add_$22(this.$$d_$Dev);t.add_$Xm(this.$$d_$4Sn);if(r.get_mainWindowInstance()&&!r.get_mainWindowInstance().closed){var u=this;_a.$3A.$Nt(r.get_mainWindowInstance(),function(n){n.chatWindowReady(u.$A3.get_$Y())})}};_im.$Ez.prototype={$Rt:null,$A3:null,$LB:null,$W2:null,$6wc:null,get_$3TB:function(){return this.$w(_im.$Ez.$6sZ)},set_$3TB:function(n){this.$P(_im.$Ez.$6sZ,n);return n},get_$4DV:function(){return this.$w(_im.$Ez.$742)},set_$4DV:function(n){this.$P(_im.$Ez.$742,n);return n},set_$do:function(n){this.$6wc=n;this.$4("RawEditorContent");return n},$Dev:function(n,t){switch(t.$3R){case 0:for(var r=0;r<t.$4C.length;r++){var f=t.$4C[r];this.get_$3TB().$317(f)}return;case 2:for(var i=t.$4X.length-1;i>=0;i--){var e=t.$4X[i];var o=this;var u=this.get_$3TB().get_$9T().$HE(function(n){var t=n;return t.$I3.get_$DF()===e.get_$DF()});u<this.get_$3TB().get_$9T().get_$A()&&this.get_$3TB().get_$9T().$5W(u)}return}},$5Fm:function(){if(!_js.$9.$o(this.get_$4DV())){this.$A3.$EeT(this.get_$4DV());var n=this;_a.$3A.$Nt(this.$Rt.get_mainWindowInstance(),function(t){t.sendChatMessage(n.$A3.get_$2O().Id,n.get_$4DV())})}},$4Sn:function(n){_js.Trace.logInfo(_a.$0.$6z,"ChatViewModel.BeforeUnload invoked.");this.$A3.get_$g6().remove_$22(this.$$d_$Dev);var t=this;_a.$3A.$Nt(this.$Rt.get_mainWindowInstance(),function(n){_js.Trace.logInfo(_a.$0.$6z,"ChatViewModel.BeforeUnload calling into main window.");n.endChat(t.$A3.get_$Y())})}};_im.$ry=function(n,t,i){this.$I=n;this.$9M=t;this.$Rt=i};_im.$ry.prototype={$I:null,$9M:null,$Rt:null,$9Dp:function(n){var r={};r.ItemID=n.get_$y();var i=new _y.$Ey;i.set_$6z(n);var t=_bc.$2I.get_$C3Q();if(n.$5h4!==-1&&n.$5h9!==-1){t.$5h3=n.$5h4;t.$5h8=n.$5h9}_js.Trace.logInfo(_a.$0.$6z,"ChatViewModelFactory: Chat.BodyText: {0}",n.get_$2eF());var u=this;this.$I.$VL(IChatViewModelFactory,function(){return u},r,t,i,!1)},$wc:function(n,t,i){return null},$1CS:function(n,t,i){var u=n.get_$6z();return new _im.$Ez(u,this.$I,this.$9M,this.$Rt)}};_im.$1R1=function(n){this.$Rt=n};_im.$1R1.prototype={$Rt:null,$9nO:function(n,t,i){for(var f=new Array(n.get_$A()),e=new Array(n.get_$A()),r=0;r<n.get_$A();r++){var u=n.get_$E(r);f[r]=u.get_$26();e[r]=u.get_$DF()}var o=$C(t)?null:t.get_$Y();var s=this;_a.$3A.$Nt(this.$Rt.get_mainWindowInstance(),function(n){n.startChat(f,e,o,i)})}};_im.$Qc=function(n){this.$$d_$48E=Function.createDelegate(this,this.$48E);this.$$d_$Dbl=Function.createDelegate(this,this.$Dbl);this.$$d_$EAF=Function.createDelegate(this,this.$EAF);this.$$d_$AES=Function.createDelegate(this,this.$AES);this.$$d_$DpI=Function.createDelegate(this,this.$DpI);_im.$Qc.initializeBase(this,[n]);_im.$Qc.$6Nu++;this.$4dM=".ChatMouseView#Handler."+_im.$Qc.$6Nu};_im.$Qc.prototype={$4dM:null,$4b:null,$NI:null,$39A:null,$A3:null,$Bvi:function(){if(!this.$A3)return null;if(!_js.$9.$o(this.$A3.get_$3o()))return this.$A3.get_$3o();var t=this.$A3.get_$g6();var n=t.get_$A();if(n)if(n===1){var i=t.get_$E(0);return String.format(_nbs.NonBootStrings.l_ChatSubjectOneParticipant_Text,i.get_$26())}else return String.format(_nbs.NonBootStrings.l_ChatSubjectMultipleParticipants_Text,n);else return null},$3T:function(){_js.$7.prototype.$3T.call(this);this.$39A.$3S();this.$4b.$1XK(100);this.$48E(null)},$8i:function(){_js.$F.prototype.$8i.call(this);if(!this.get_$k()){if(this.$A3){this.$A3.get_$g6().remove_$22(this.$$d_$DpI);this.$A3.$1B(_h.$1g.$qH.$3D,this.$$d_$AES)}this.$A3=null;return}var n=this.get_$k();this.$A3=n.$A3;this.$A3.get_$g6().add_$22(this.$$d_$DpI);this.$A3.$p(_h.$1g.$qH.$3D,this.$$d_$AES);this.$A3.$p(_h.$1g.$4Dc.$3D,this.$$d_$EAF)},$4T:function(){_js.$7.prototype.$4T.call(this);if(!this.$u){this.$NI.$1B(_b.$4C.$3up.$3D,this.$$d_$Dbl);$(window).unbind(this.$4dM);this.$NI=null;this.$4b=null;this.$39A=null;return}this.$4b=this.$u.$1N("TranscriptScrollRegion");this.$NI=this.$u.$1N("TranscriptLabel");this.$39A=this.$u.$1N("Editor");this.$NI.$p(_b.$4C.$3up.$3D,this.$$d_$Dbl);$(window).bind("resize"+this.$4dM,this.$$d_$48E);this.$7Cz();this.$39A.$EaC()},$7Cz:function(){var n=this.$Bvi();_js.$9.$o(n)||(window.document.title=n)},$DpI:function(n,t){this.$7Cz()},$AES:function(n,t){this.$7Cz()},$EAF:function(n,t){if(this.$A3.get_$4Db()){var i=this.$39A.get_$S().children("textarea");i.length>0&&i[0].setAttribute("disabled","true")}},$Dbl:function(n,t){var i=this.$4b.get_$S();var r=i.prop("scrollHeight");i.scrollTop(r-i.height())},$48E:function(n){var t=$(window).height();t>=425&&this.$4b.get_$S().height(251+t-425)}};_im._TI=function(){};_im._TI.$$cctor=function(){var n="ChatMouseView";new _A(n,function(){_im._TI.$1[n]===undefined&&(_im._TI.$1[n]=[null,[[-1,0,["ParticipantsViewModel"],[_im._TI.$ClH],null,"DataContext",null,_im._TI.$Z,1,null,null,null]],null,[[-1,0,["Chat","BodyText"],[_im._TI.$576,_im._TI.$CiJ],null,"Html",null,_im._TI.$Ix,1,null,null,null]],[[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$576,_im._TI.$8nG],null,"Text",null,_im._TI.$2pA,1,null,null,null],[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$576,_im._TI.$8nG],null,"AriaLabel",null,_im._TI.$1l,1,null,null,null]],[[-1,0,["Chat","Status"],[_im._TI.$576,_im._TI.$CiK],null,"Html",null,_im._TI.$Ix,1,null,null,null]],[[-1,4,null,null,null,"EditorAriaLabel",null,_im._TI.$1pw,0,null,null,null,_u.Strings.l_IM_AT_Textbox_Text],[-1,0,["SendCommand"],[_im._TI.$ClJ],null,"EnterCommand",null,_im._TI.$Ceg,1,null,null,null],[-1,0,["GetEditorContentCommand"],[_im._TI.$ClG],_im._TI.$ClL,"GetContentCommand",_im._TI.$2R7,_im._TI.$2R9,2,null,null,null],[-1,0,["SendText"],[_im._TI.$ClK],_im._TI.$ClN,"Content",_im._TI.$561,_im._TI.$562,2,null,null,null],[-1,0,["RawEditorContent"],[_im._TI.$ClI],_im._TI.$ClM,"RawContent",_im._TI.$Cef,_im._TI.$563,2,null,null,null]]]);var t=_im._TI._hf.childNodes[0].cloneNode(!0);var i=new _z.$CS(_B.$3(t,[0,3]),_js.$2.Instance.$2(_y.$W),_js.$2.Instance.$2(_a.$t),_js.$2.Instance.$2(_ff.$M));i.set_$1zP("_im_8 ms-font-weight-regular ms-font-color-black");i.set_$3IH(!1);i.set_$Amz(!0);var o=new _b.$4C(_B.$3(t,[0,2,0]));var s=new _b.$OQ(_B.$3(t,[0,1,1]),_js.$2.Instance.$2(_ff.$M));var r=new _b.$4C(_B.$3(t,[0,1,0]));var f=new _fce.$1F(_B.$3(t,[0,1]),_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$M));var u=new _js.$7(_B.$3(t,[0,0,0,0]));u.set_$6("ReadOnlyRecipientWellView");var e=new _fce.$1F(_B.$3(t,[0,0,0]),_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$M));return new _B(t,[e,u,f,r,s,o,i]).R({TranscriptScrollRegion:f,TranscriptLabel:r,Editor:i})},_im.$Ez,_im.$Qc,!1,!1,!1,0,_im._TI.$1)};_im._TI.$9S=function(){var n=window.document.createElement("DIV");n.innerHTML="<div> <div class='_im_2'> <div class='_im_3 ms-bg-color-neutralLighter'> <div class='_im_4'> <div></div> </div> </div> <div class='_im_5'> <span></span> <div></div> </div> <div class='_im_6 ms-font-weight-regular ms-font-color-neutralSecondary ms-bg-color-neutralLighter ms-border-color-neutralTertiaryAlt'> <span></span> </div> <div class='_im_7 border-color-transparent ms-border-color-neutralTertiaryAlt-hover'></div> </div> </div>";_js.$F.get_$9G().appendChild(n);return n};_im._TI.$ClH=function(n){return n.get_$3TB()};_im._TI.$576=function(n){return n.$A3};_im._TI.$CiJ=function(n){return n.get_$2eF()};_im._TI.$8nG=function(n){return n.get_$8ZE()};_im._TI.$CiK=function(n){return n.get_$GZ()};_im._TI.$ClJ=function(n){return n.$LB};_im._TI.$ClG=function(n){return n.$W2};_im._TI.$2R7=function(n){return n.$1T3};_im._TI.$ClK=function(n){return n.get_$4DV()};_im._TI.$561=function(n){return n.get_$DY()};_im._TI.$ClI=function(n){return n.$6wc};_im._TI.$Cef=function(n){return n.get_$mf()};_im._TI.$Z=function(n,t){n.set_$k(t)};_im._TI.$Ix=function(n,t){n.set_$Sa(t)};_im._TI.$2pA=function(n,t){n.set_$1K(t)};_im._TI.$1l=function(n,t){n.set_$4E(t)};_im._TI.$Ceg=function(n,t){n.set_$Qn(t)};_im._TI.$ClL=function(n,t){n.$W2=t};_im._TI.$2R9=function(n,t){n.set_$4nF(t)};_im._TI.$ClN=function(n,t){n.set_$4DV(t)};_im._TI.$562=function(n,t){n.set_$DY(t)};_im._TI.$ClM=function(n,t){n.set_$do(t)};_im._TI.$563=function(n,t){n.set_$mf(t)};_im._TI.$1pw=function(n,t){n.$2HQ=t};_im.$1A6.registerClass("_im.$1A6",_h.$1A3.$$(Number));_im.$102.registerClass("_im.$102",null,IChatActionFactory);_im.$1Ec.registerClass("_im.$1Ec",_h.$1A3.$$(Boolean));_im.$1Ed.registerClass("_im.$1Ed");_im.$1HK.registerClass("_im.$1HK",_h.$1A3.$$(Number));_im.$1JN.registerClass("_im.$1JN",_h.$1A3.$$(Number));_im.$13b.registerClass("_im.$13b",_h.$1A3.$$(Number));_im.$1P0.registerClass("_im.$1P0",_h.$1A3.$$(Number));_im.$1PY.registerClass("_im.$1PY",_h.$1A3.$$(Number));_im.$1QM.registerClass("_im.$1QM",_h.$1A3.$$(Number));_im.$Y0.registerClass("_im.$Y0",_a.$Fj);_im.$18i.registerClass("_im.$18i");_im.$1R9.registerClass("_im.$1R9",_h.$1A3.$$(Number));_im.$1TH.registerClass("_im.$1TH",_h.$1A3.$$(Number));_im.$1CO.registerClass("_im.$1CO");_im.$4s.registerClass("_im.$4s",_js.$Ec,IChatManager,_js.$13p);_im.$103.registerClass("_im.$103",null,IChatManagerFactory);_im.$Lm.registerClass("_im.$Lm",_js.$Ec);_im.$104.registerClass("_im.$104",_js.$Ec);_im.$105.registerClass("_im.$105",null,IChatProvider);_im.$106.registerClass("_im.$106",null,IChatProviderFactory);_im.$oh.registerClass("_im.$oh",_js.$1Ze,IPresenceManager);_im.$16m.registerClass("_im.$16m",_im.$oh);_im.$SL.registerClass("_im.$SL",_js.$1Ze);_im.$1Nz.registerClass("_im.$1Nz",_im.$SL);_im.$1O9.registerClass("_im.$1O9");_im.$oi.registerClass("_im.$oi");_im.$4h.registerClass("_im.$4h");IMComponent.registerClass("IMComponent",null,_a.$1X7);_im.$rx.registerClass("_im.$rx");_im.$Ez.registerClass("_im.$Ez",_a.$En);_im.$ry.registerClass("_im.$ry",null,IChatViewModelFactory,_bc.$1Jj);_im.$1R1.registerClass("_im.$1R1",null,_h.$14A);_im.$Qc.registerClass("_im.$Qc",_js.$7);_im._TI.registerClass("_im._TI");_im.$4s.$2ZJ="SignInState";_im.$4s.$4yR="IsSignedIn";_im.$4s.$27t="Presence";_im.$SL.$7Jp=5e3;_im.$Ez.$742=new _H("SendText",String,_im.$Ez,"");_im.$Ez.$6sZ=new _H("ParticipantsViewModel",_rw.$4c,_im.$Ez);_im.$Qc.$6Nu=0;_im._TI._hf=_im._TI.$9S();_im._TI.$1={};_im._TI.$$cctor();
window.scriptsLoaded['microsoft.exchange.clients.owa2.client.core.im.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
